---
title: Introduction à R pour<br>Épidémiologie appliquée
subtitle: <br>Scales, themes, and dynamic labeling in {ggplot2}
author: ''
date: '[contact@appliedepi.org](mailto:contact@appliedepi.org)'
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    css: xaringan-themer.css
params:
  lang: en
---

class: center, middle, inverse, title-slide

```{r, eval=F, echo=F, include=F}
# Must do in order to render.

#pacman::p_load(xaringan)
#devtools::install_github("gadenbuie/xaringanExtra")
#remotes::install_github("mitchelloharawild/icons")
#icons::download_fontawesome()

# Render with xaringan::infinite_moon_reader()
# Slides will appear in viewer, and will update as you edit/save
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.retina = 3  ## retina more effective than w/h (according to twitter)
                      # fig.width = 16, 
                      # fig.height = 10
                      )
## I dont know why this is included in the example xaringan slide 
## but is something to do with background images
options(htmltools.dir.version = FALSE)

## install and load necessary packages 
pacman::p_load(
  rio,        # importing data  
  here,       # relative file pathways  
  janitor,    # data cleaning and tables
  epikit,     # age categories
  lubridate,  # working with dates
  ggrepel,    # smart labels
  ggExtra,    # extras
  scales,     # formatting of scales
  cowplot,    # combining plots
  flair,      # flair colored text
  tidyverse,  # data management and visualization
  xaringanthemer  # for styling presentation 
)

# github packages
pacman::p_load_gh(
     "hadley/emo"
)


```

```{r xaringan-themer, include=FALSE}

## define presentation colours (theme) using {xaringanthemer} package 
## https://pkg.garrickadenbuie.com/xaringanthemer/articles/xaringanthemer.html

## epirhandbook logo colours: 
  ## blue: "#00538c"
  ## green: "#007732"
  ## lighter green: "#48a878"

## see ?style_mono_accent for all the things can customise
style_mono_accent(
  base_color = "#00538c", 
  link_color = "#48a878", 
  ## add logo to the title page (bit bigger)
  title_slide_background_image = "https://raw.githubusercontent.com/appliedepi/slides/master/images/logo.png", 
  title_slide_background_position = "95% 95%", 
  title_slide_background_size = "25%", 
  ## add logo to all following slides
  background_image = "https://raw.githubusercontent.com/appliedepi/slides/master/images/logo.png", 
  background_size = "10%",
  background_position = "100% 0%"
)

options(htmltools.dir.version = FALSE)

```

```{r, include=FALSE}
# data prep --------------------------------------------------------------------
surv <- rio::import(here::here("data", "surveillance_linelist_clean_20141201.rds"))

# gen <- googlesheets4::read_sheet(
#   "https://docs.google.com/spreadsheets/d/1-Xqv5xvakmhKSxipVP6a9GF3H54RN-rbilhdNhPHx6M/edit#gid=998182281",
#   range = "generic") %>%
#   clean_names()
# 
# mod6_2 <- googlesheets4::read_sheet(
#   "https://docs.google.com/spreadsheets/d/1-Xqv5xvakmhKSxipVP6a9GF3H54RN-rbilhdNhPHx6M/edit#gid=998182281",
#   range = "mod6_2", col_types = "c") %>%
#   clean_names()
```

```{css, echo=F}
    .remark-slide table{
      border: none
    }
    .remark-slide-table {
      
    }
    tr:first-child {
      border-top: none;
  }
    tr:last-child {
    border-bottom: none;
  }
```

```{css, echo=F}
/* THIS IS A CSS CHUNK - THIS IS A COMMENT */
/* Size of font in code echo. E.g. 10px or 50% */
.remark-code {
  font-size: 70%;
}
/* Size of font in text */
.medium-text {
  font-size: 75%;     
}
/* Size of font in tables */
.small-table table {
  font-size: 6px;     
}
.medium-table table {
  font-size: 8px;     
}
.medium-large-table table {
  font-size: 10px;     
}
```

# Introduction à R pour l'épidémiologie appliquée

### {ggplot2} - Échelles, thèmes et étiquettes

[contact@appliedepi.org](mailto:contact@appliedepi.org)

---

# Grammaire graphique

## Revenons à cette séquence qui construit un ggplot.

L'ordre des couches se présente généralement comme suit :

1) **"Ouvrir" la parcelle**

--

2) **"Mapper" les colonnes de données**

--

3) **Ajoute (`+`) "Couches "geom**

--

4) **Modifier les "échelles"** comme l'échelle des couleurs ou les ruptures de l'axe des ordonnées

--

5) **Ajoute des éléments de conception d'intrigue "à thème"** tels que les étiquettes d'axe, le titre, la légende, les polices, les tailles de texte, les thèmes d'arrière-plan ou la rotation des axes.

???
N'oublie pas que même si les commandes sont longues, il est infiniment plus facile de les modifier et de les recycler que dans Excel

---

class: inverse, center, middle

## Échelles en {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "scales.png")))
```

---

# Balances - vue d'ensemble

Les commandes d'échelle remplacent les valeurs par défaut pour l'affichage de l'esthétique, comme par exemple :

- *Quel* Les couleurs ou les formes à afficher
- *Comment* les dates ou les proportions sont écrites dans les étiquettes des axes
- Le min/max et la fréquence des ruptures d'axes

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"Generic formula: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"Formule générique: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"Общая формула: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"Fórmula genérica: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"1) scale_ : this prefix never changes." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"1) scale_ : ce préfixe ne change jamais." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"1) scale_: этот префикс никогда не меняется" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"1) scale_ : este prefijo nunca cambia" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"2) aesthetic: _fill_ or _color_ or _x_ or _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"2) aesthetic: _fill_ ou _color_ ou _x_ ou _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"2) aesthetic: _fill_ или _color_ или _x_ или _y_ и т.д." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"2) aesthetic: _fill_ o _color_ или _x_ o _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"3) method: _continuous() or _discrete() or _manual() or _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"3) method: _continuous() ou _discrete() ou _manual() ou _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"3) method: _continuous() или _discrete() или _manual() or _date() и т.д." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"3) method: _continuous() o _discrete() или _manual() o _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, results="asis", echo=FALSE}
"scale_color_continuous()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("color", color = "cornflowerblue") %>%  
  flair("continuous", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, results="asis", echo=FALSE}
"scale_x_date()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("x", color = "cornflowerblue") %>%  
  flair("date", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, results="asis", echo=FALSE}
"scale_x_manual()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("x", color = "cornflowerblue") %>%  
  flair("manual", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

---

# Exemples d'échelles

Quelques exemples de commandes d'échelles :

| Tu veux ajuster                                    | Commande de mise à l'échelle | 
| -------------------------------------------------- | ---------------------------- |
| axe des y continu                                  | `scale_y_continuous()`                             | 
| date axe des x                                     | `scale_x_date()`                             | 
| axe des x catégorique                              | `scale_x_discrete()`                             | 
| remplissage, continu                               | `scale_fill_continuous()`                             | 
| remplissage, continu                               | `scale_fill_gradient()`                             | 
| couleur, affectation manuelle                      | `scale_color_manual()`                             | 

---

# Balances - par défaut

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar()
```

Ci-dessus, le remplissage d'un diagramme à barres utilise la fonction **les couleurs par défaut et les ruptures d'axe**:

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
theme_gray(base_size = 18)
```

]

???
Ignore les étiquettes de l'axe des x qui se chevauchent, pour la simplicité du code, nous ne les ajustons pas dans cette diapositive.

---

# Balances - remplissage ajusté

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
*scale_fill_manual(        
*  values = c(
*    "male"     = "violetred", 
*    "female"   = "aquamarine"))


```

À l'intérieur `scale_fill_manual()` nous fournissons **manuel** missions  
dans un vecteur `c()`.

.note de bas de page[Utilisation *na.value = "grey"* pour les valeurs manquantes
]

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "male" = "violetred", 
     "female" = "aquamarine")) +
theme_gray(base_size = 16)
```

]

???
Discute des arguments na.value= dans la plupart des commandes d'échelle, et de la différence entre avoir des valeurs NA dans les données et avoir une valeur manquante explicite telle que "Inconnu".

---

# Échelles - colorbrewer

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
*scale_fill_brewer(
*   type = "qual",
*   na.value = "grey50")

```

Échelles - colorbrewer

.footnote [Utilisation *na.value = "gris"* pour les valeurs manquantes
]

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_brewer(type = "qual", na.value = "grey50")+
theme_gray(base_size = 16)
```

]

???
Mentionne brièvement les `na.value=` dans la plupart des commandes d'échelle, et la différence entre avoir des valeurs NA dans les données et avoir une valeur manquante explicite telle que "Inconnu".

---

# Échelles - axe des ordonnées ajusté

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "male" = "violetred", 
     "female" = "aquamarine")) +
*scale_y_continuous(
*  breaks = seq(from = 0,
*               to = 250,
*               by = 10))
```

En `scale_y_continuous()` nous ajustons les ruptures de l'axe des ordonnées à l'aide de `seq()` pour définir une séquence numérique.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "male" = "violetred", 
     "female" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10)) +
theme_gray(base_size = 18)
```

]

---

# Échelles - commence les axes à 0

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "male" = "violetred", 
     "female" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10),
* expand = c(0, 0)) +
*scale_x_discrete(
*  expand = c(0, 0))
```

En `scale_x_` ou `scale_y_` utilise `expand = c(0,0)` pour supprimer l'espace excédentaire autour de l'intrigue.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sex)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "male" = "violetred", 
     "female" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10),
  expand = c(0,0)) +
scale_x_discrete(
  expand = c(0,0)) +
theme_grey(base_size = 18)
```

]

---

# Échelles - étiquettes de l'axe de la date

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram()
```

L'échelle par défaut des axes de date varie en fonction de l'étendue de tes données.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram()+
theme_grey(base_size = 18)

```

]

---

# Balances - ruptures de l'étiquette de la date

.pull-left[

```{r, eval=F, echo=params$lang == "en"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 months") #2 months

```

```{r, eval=F, echo=params$lang == "fr"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 months") #2 mois

```

```{r, eval=F, echo=params$lang == "ru"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 months") #2 месяца

```

```{r, eval=F, echo=params$lang == "es"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 months") #2 meses

```

Ajuste les étiquettes des axes avec `scale_x_date()`.

Utilise `date_breaks=` des valeurs comme "1 semaine", "2 semaines" ou "3 mois".

Ces valeurs permettent d'ajuster la rupture d'axe *étiquettes* et non les cases de l'histogramme !

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months") +
theme_grey(base_size = 18)

```

]

???
Pour des conseils sur les bins de geom\_histogram(), voir la page Epi R Handbook epicurves.

---

# Échelles - étiquettes de l'axe de la date

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months",
* date_labels = "%d %b\n%Y")

```

Spécifie le format de l'étiquette de date à `date_labels=` à l'aide  
["syntaxe "strptime](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/strptime)

`"%d %b %Y"` pour JJ MM AAAA.

.note de bas de page [Voir le manuel Epi R [Epicurves](https://epirhandbook.com/epidemic-curves.html) et [Cordes](https://epirhandbook.com/characters-and-strings.html) chapitres
]

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months",
  date_labels = "%d %b\n%Y"
) +
theme_grey(base_size = 18)

```

]

???
/n est une nouvelle ligne

---

# Échelles - étiquettes auto-efficaces

.pull-left[

```{r, eval=F, echo=params$lang == "en"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", #2 weeks
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "fr"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", # 2 semaines
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "ru"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", # 2 недели
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "es"}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", #2 semanas
* labels = label_date_short() )

```

Ou bien, assigne simplement `labels=` à `label_date_short()` de [{scales}](https://scales.r-lib.org/)

L'année n'est pas répétée sur chaque étiquette.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_onset)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = scales::label_date_short())+
theme_grey(base_size = 18)

```

]

---

class: inverse, center, middle

## Étiquettes en {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "labels.png")))
```

---

# Étiquettes de tracé

.pull-left[

```{r, echo=TRUE, eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")
```

]

.pull-right[

```{r, echo=FALSE, eval=TRUE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(x = date_onset, fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
theme_grey(base_size = 18)
```

]

---

# Étiquettes de tracé

.pull-left[

```{r, echo=params$lang == "en", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Epidemic curve of Ebola outbreak",
*  subtitle = "Confirmed cases, 2014",
*  x = "Date",
*  y = "Number of cases",
*  caption = "Fictional Ebola data",
*  fill = "Hospital"
) +
```

```{r, echo=params$lang == "fr", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Courbe épidémique de l'épidémie d'ebola",
*  subtitle = "Cas confirmés, 2014",
*  x = "Date",
*  y = "Nombre de cas",
*  caption = "Données fictionnelles",
*  fill = "Hôpital"
) +
```

```{r, echo=params$lang == "ru", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Эпидемическая кривая вспышки лихорадки Эбола",
*  subtitle = "Подтвержденные случаи, 2014 год",
*  x = "Дата",
*  y = "Количество случаев",
*  caption = "Вымышленные данные по лихорадке Эбола",
*  fill = "Больница"
) +
```

```{r, echo=params$lang == "es", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Curva epidémica del brote de ébola",
*  subtitle = "Casos confirmados, 2014",
*  x = "Fecha",
*  y = "Número de casos",
*  caption = "Datos ficticios sobre el ébola",
*  fill = "Hospital"
) +
```

Utilise `labs()` comme ci-dessus. Remarque : modifie le titre de la légende via l'esthétique qui a créé la légende (par ex. `fill=`).

]

.pull-right[

```{r, echo=FALSE, eval=params$lang == "en", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Epidemic curve of Ebola outbreak",
  subtitle = "Confirmed cases, 2014",
  x = "Date",
  y = "Number of cases",
  caption = "Fictional Ebola data",
  fill = "Hospital"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "fr", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Courbe épidémique de l'épidémie d'ebola",
  subtitle = "Cas confirmés, 2014",
  x = "Date",
  y = "Nombre de cas",
  caption = "Données fictionnelles",
  fill = "Hôpital"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "ru", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
 title = "Эпидемическая кривая вспышки лихорадки Эбола",
 subtitle = "Подтвержденные случаи, 2014 год",
 x = "Дата",
 y = "Количество случаев",
 caption = "Вымышленные данные по лихорадке Эбола",
 fill = "Больница"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "es", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_onset,
    fill = hospital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Curva epidémica del brote de ébola",
  subtitle = "Casos confirmados, 2014",
  x = "Fecha",
  y = "Número de casos",
  caption = "Datos ficticios sobre el ébola",
  fill = "Hospital"
) +
theme_grey(base_size = 18)
```

]

---

# Étiquettes dynamiques

Incorporer un code à l'intérieur `str_glue("text here {CODE HERE} text here")`  
Le code sera mis à jour avec les données.

```{r, eval=params$lang == "en", echo=params$lang == "en"}
str_glue("Data as of {Sys.Date()}")
```

```{r, eval=params$lang == "fr", echo=params$lang == "fr"}
str_glue("Données à partir de {Sys.Date()}")
```

```{r, eval=params$lang == "ru", echo=params$lang == "ru"}
str_glue("Данные по состоянию на {Sys.Date()}")
```

```{r, eval=params$lang == "en", echo=params$lang == "es"}
str_glue("Datos a partir de {Sys.Date()}")
```

--

```{r, eval=params$lang == "en", echo=params$lang == "en"}
str_glue("{fmt_count(surv, is.na(date_onset))} cases missing onset and not shown")
```

```{r, eval=params$lang == "fr", echo=params$lang == "fr"}
str_glue("La date d'apparition est manquante pour {fmt_count(surv, is.na(date_onset))}")
```

```{r, eval=params$lang == "ru", echo=params$lang == "ru"}
str_glue("{fmt_count(surv, is.na(date_onset))} случаи с отсутствующим началом и не показаны")
```

```{r, eval=params$lang == "es", echo=params$lang == "es"}
str_glue("{fmt_count(surv, is.na(date_onset))} casos que faltan para el inicio y no se muestran")
```

.footnote[Voir la [Manuel de l'Epi R Chapitre sur les cordes](https://epirhandbook.com/characters-and-strings.html#dynamic-strings) et le chapitre {stringr} paquet.

]

???
Explique que dans str\_glue, tout ce qui est entre crochets sera exécuté comme du code R.

---

class: inverse, center, middle

## Thèmes en {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "themes.png")))
```

---

# Thèmes

Les thèmes sont **sans données** des caractéristiques de conception, par exemple :

- Arrière-plan du canevas de tracé
- Taille, couleur et orientation du texte
- Position de la légende

--

Le pouvoir de la {ggplot2} - tu peux faire des ajustements extrêmement petits

... si tu le souhaites.

---

# Thèmes

.pull-left[

["Thèmes complets"](https://ggplot2.tidyverse.org/reference/ggtheme.html) sont faciles à ajouter.

```{r, eval=F, echo=params$lang == "en"}
# Try one of these...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "fr"}
# Essayez un de ces...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "ru"}
# Попробуйте одно из этих...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "es"}
# Prueba uno de estos...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

Essaie l'argument `base_size = 16` pour augmenter rapidement la taille du texte.

]

.pull-right[

```{r, echo=FALSE, eval=TRUE, tidy=FALSE}

minimal <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_minimal()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_minimal(base_size = 18)



bw <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_bw()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_bw(base_size = 18)



grey <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_grey()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_grey(base_size = 18)


dark <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_dark()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_dark(base_size = 18)



void <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_void()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_void(base_size = 18)



light <- ggplot(data = surv,
       mapping = aes(
         x = age_years,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_light()",
    x = "Age (years)",
    y = "Height (cm)")+
  theme_light(base_size = 18)


themes_plots <- cowplot::plot_grid(
  minimal, light,
  bw, grey,
  dark, void,
  nrow = 3, rel_widths = c(2,2))

themes_plots

```

]

---

# Micro-ajustements

Effectue des micro-ajustements au sein de `theme()`.

Fournis des arguments pour chaque petit changement que tu veux faire, par exemple :

| Composant de tracé                                 | Argument thématique          | 
| -------------------------------------------------- | ---------------------------- |
| position de la légende                             | `legend.position = `                             | 
| direction de la légende (horizontale ou verticale) | `legend.direction = `                             | 

--

Ceux-ci peuvent être *très très* spécifiques :

| Composante de l'intrigue                           | Argument thématique          | 
| -------------------------------------------------- | ---------------------------- |
| Longueur des ticks de l'axe X                      | `axis.ticks.length.x = `                             | 

Il existe littéralement des centaines d'options.

???
Pense à tous les ajustements minutieux que tu fais lorsque tu crées un graphique dans Excel. Combien de fois dois-tu refaire toutes ces étapes ? Toutes ces étapes peuvent être codées, ce qui rend le tracé ajustable.

---

# Thèmes

.pull-left[

Effectue des micro-ajustements au sein de `theme()`.

```{r, echo=params$lang == "en", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Height by age",
  x = "Age (years)",
  y = "Height (cm)",
  color = "sex")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "fr", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Taille par âge",
  x = "Âge (années)",
  y = "Taille (cm)",
  color = "Sexe")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "ru", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
   title = "Рост по возрасту",
  x = "Возраст (годы)",
  y = "Рост (см))",
  color = "Пол")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "es", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Altura por edad",
  x = "Edad (años)",
  y = "Altura (cm)",
  color = "Género")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

]

.pull-right[

La syntaxe demande de l'entraînement - voir [cette liste](https://ggplot2.tidyverse.org/reference/theme.html) des arguments spécifiques aux fonctionnalités.

```{r, echo=FALSE, eval=params$lang == "en", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Height by age",
  x = "Age (years)",
  y = "Height (cm)",
  color = "sex")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "fr", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Taille par âge",
  x = "Âge (années)",
  y = "Taille (cm)",
  color = "Sexe")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "ru", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
   title = "Рост по возрасту",
  x = "Возраст (лет)",
  y = "Рост (см))",
  color = "Пол")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "es", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_years,
    y = ht_cm,
    color = sex),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Altura por edad",
  x = "Edad (años)",
  y = "Altura (cm)",
  color = "Género")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

]

???
Parle de ces arguments de theme() et explique comment ils se composent de deux parties, tout comme `mapping = aes()`.
Explique que personne ne les a tous mémorisés, mais que les plus courants sont faciles à retenir une fois que tu les utilises suffisamment.  
N'oublie pas de les ajouter APRÈS chaque thème complet.

---

# Thèmes - `element_text()`

Si tu changes *texte* les micro-ajustements doivent souvent être effectués *dans* `element_text()`

```{r, eval=F, echo=T}
theme(
 legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

Il s'agit d'une syntaxe similaire à `mapping = aes()`

???
Parle de ces arguments theme() et explique comment ils se composent de deux parties, tout comme `mapping = aes()`.
Explique que personne ne les a tous mémorisés, mais que les plus courants sont faciles à retenir une fois que tu les utilises suffisamment.

---

class: inverse, center, middle

## Fais de l'exercice !

Va sur le site du cours  
Ouvre l'exercice du module 5, partie 2, et connecte-toi.  
Suis les instructions pour continuer à coder dans ton projet R "ebola".
Informe un instructeur si tu n'es pas sûr de ce que tu dois faire.

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "breakout", "teamwork3.png")))
```


