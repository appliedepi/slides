---
title: "Introduction à R pour<br>Épidémiologie appliquée"
subtitle: "<br>Scales, themes, and dynamic labeling in {ggplot2}"
author: "Applied Epi"
date: '[contact@appliedepi.org](mailto:contact@appliedepi.org)'
output:
  xaringan::moon_reader:
    seal: false
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
    css: xaringan-themer.css
params:
  lang: "fr"
---

class: center, middle, inverse, title-slide

```{r, eval=F, echo=F, include=F}
# Must do in order to render.

#pacman::p_load(xaringan)
#devtools::install_github("gadenbuie/xaringanExtra")
#remotes::install_github("mitchelloharawild/icons")
#icons::download_fontawesome()

# Render with xaringan::infinite_moon_reader()
# Slides will appear in viewer, and will update as you edit/save
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      warning = FALSE, 
                      message = FALSE, 
                      fig.retina = 3  ## retina more effective than w/h (according to twitter)
                      # fig.width = 16, 
                      # fig.height = 10
                      )
## I dont know why this is included in the example xaringan slide 
## but is something to do with background images
options(htmltools.dir.version = FALSE)

## install and load necessary packages 
pacman::p_load(
  rio,        # importing donnees  
  here,       # relative file pathways  
  janitor,    # donnees cleaning and tables
  epikit,     # age categories
  lubridate,  # working with dates
  ggrepel,    # smart labels
  ggExtra,    # extras
  scales,     # formatting of scales
  cowplot,    # combining plots
  flair,      # flair colored text
  tidyverse,  # donnees management and visualization
  xaringanthemer  # for styling presentation 
)

# github packages
pacman::p_load_gh(
     "hadley/emo"
)


```

```{r xaringan-themer, include=FALSE}

## define presentation colours (theme) using {xaringanthemer} package 
## https://pkg.garrickadenbuie.com/xaringanthemer/articles/xaringanthemer.html

## epirhandbook logo colours: 
  ## blue: "#00538c"
  ## green: "#007732"
  ## lighter green: "#48a878"

## see ?style_mono_accent for all the things can customise
style_mono_accent(
  base_color = "#00538c", 
  link_color = "#48a878", 
  ## add logo to the title page (bit bigger)
  title_slide_background_image = "https://raw.githubusercontent.com/appliedepi/slides/master/images/logo.png", 
  title_slide_background_position = "95% 95%", 
  title_slide_background_size = "25%", 
  ## add logo to all following slides
  background_image = "https://raw.githubusercontent.com/appliedepi/slides/master/images/logo.png", 
  background_size = "10%",
  background_position = "100% 0%"
)

options(htmltools.dir.version = FALSE)

```

```{r, include=FALSE}
# donnees prep --------------------------------------------------------------------
surv <- rio::import(here::here("data", "linelist_surveillance_nettoyee_20141201.rds"))

surv <- surv %>% 
  mutate(sexe = ifelse(sexe == "Desconocido",NA,sexe))

# gen <- googlesheets4::read_sheet(
#   "https://docs.google.com/spreadsheets/d/1-Xqv5xvakmhKSxipVP6a9GF3H54RN-rbilhdNhPHx6M/edit#gid=998182281",
#   range = "generic") %>%
#   clean_names()
# 
# mod6_2 <- googlesheets4::read_sheet(
#   "https://docs.google.com/spreadsheets/d/1-Xqv5xvakmhKSxipVP6a9GF3H54RN-rbilhdNhPHx6M/edit#gid=998182281",
#   range = "mod6_2", col_types = "c") %>%
#   clean_names()
```

```{css, echo=F}
    .remark-slide table{
      border: none
    }
    .remark-slide-table {
      
    }
    tr:first-child {
      border-top: none;
  }
    tr:last-child {
    border-bottom: none;
  }
```

```{css, echo=F}
/* THIS IS A CSS CHUNK - THIS IS A COMMENT */
/* Size of font in code echo. E.g. 10px or 50% */
.remark-code {
  font-size: 70%;
}
/* Size of font in text */
.medium-text {
  font-size: 75%;     
}
/* Size of font in tables */
.small-table table {
  font-size: 6px;     
}
.medium-table table {
  font-size: 8px;     
}
.medium-large-table table {
  font-size: 10px;     
}
```

# Introduction à R pour l'épidémiologie appliquée

### {ggplot2} - Échelles, thèmes et étiquettes

[contact@appliedepi.org](mailto:contact@appliedepi.org)

---

# Grammaire des Graphiques

## Revenons à la séquence qui construit un ggplot.

L'ordre des couches se présente généralement comme suit :

1) **"Ouverture" du graphique**

--

2) **"Cartographier" les colonnes de données**

--

3) **Ajout (`+`) des couches "geom"**

--

4) **Modification des "échelles"**, telle que l'échelle des couleurs ou des ruptures de l'axe y

--

5) **Ajout d'éléments visuels "à thème"**, tels que le nom des axes, le titre, la légende, les polices, les tailles de texte, les thèmes d'arrière-plan ou la rotation des axes.

???
N'oubliez pas que même si les commandes sont longues, il est infiniment plus facile de les modifier et de les recycler que dans Excel

---

class: inverse, center, middle

## Échelles dans {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "scales.png")))
```

---

# Échelles - vue d'ensemble

Les commandes d'échelle remplacent les valeurs par défaut pour l'affichage de l'esthétique, comme par exemple :

- *Quelles* couleurs ou formes à afficher
- *Comment* les dates ou les proportions sont écrites dans les étiquettes des axes
- Le min/max et la fréquence des ruptures d'axes

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"Generic formula: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"Formule générique: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"Общая формула: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"Fórmula genérica: scale_aesthetic_method()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"1) scale_ : this prefix never changes." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"1) scale_ (échelle) : ce préfixe ne change jamais." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"1) scale_: этот префикс никогда не меняется" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"1) scale_ : este prefijo nunca cambia" %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"2) aesthetic: _fill_ or _color_ or _x_ or _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"2) aesthetic (esthétique) : _fill_ ou _color_ ou _x_ ou _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"2) aesthetic: _fill_ или _color_ или _x_ или _y_ и т.д." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"2) aesthetic: _fill_ o _color_ или _x_ o _y_ etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, eval=params$lang == "en", results="asis", echo=FALSE}
"3) method: _continuous() or _discrete() or _manual() or _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "fr", results="asis", echo=FALSE}
"3) method (méthode) : _continuous() ou _discrete() ou _manual() ou _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "ru", results="asis", echo=FALSE}
"3) method: _continuous() или _discrete() или _manual() or _date() и т.д." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, eval=params$lang == "es", results="asis", echo=FALSE}
"3) method: _continuous() o _discrete() или _manual() o _date() etc." %>%
  flair("scale", color = "darkgreen") %>%
  flair("aesthetic", color = "cornflowerblue") %>%  
  flair("method", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

--

```{r, results="asis", echo=FALSE}
"scale_color_continuous()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("color", color = "cornflowerblue") %>%  
  flair("continuous", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```

```{r, results="asis", echo=FALSE}
"scale_x_date()" %>%
  flair("scale", color = "darkgreen") %>%
  flair("x", color = "cornflowerblue") %>%  
  flair("date", color = "deeppink") %>%
  flair_all(before = "<h4>", after = "</h4>") %>%
  cat()
```


---

# Exemples d'échelles

Quelques exemples de commandes d'échelles :

| Vous voulez ajuster                                    | Commande d'échelle | 
| -------------------------------------------------- | ---------------------------- |
| axe y continu                                  | `scale_y_continuous()`                             | 
| axe x de dates                                    | `scale_x_date()`                             | 
| axe x, données catégoriques                              | `scale_x_discrete()`                             | 
| couleur de remplissage, données continues               | `scale_fill_continuous()`                             | 
| couleur de remplissage, données continues                               | `scale_fill_gradient()`                             | 
| couleur, modification manuelle                      | `scale_color_manual()`                             | 

---

# Échelles - valeurs par défaut

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar()
```

Ci-dessus, le graphique à barres utilise **les valeurs par défaut de couleurs et de ruptures d'axe**:

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
theme_gray(base_size = 18)
```

]

???
Ignorez les étiquettes de l'axe x qui se chevauchent, pour garder ce code simple, nous ne les ajustons pas dans cette diapositive.

---

# Échelles - remplissage ajusté

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
*scale_fill_manual(        
*  values = c(
*    "homme"     = "violetred", 
*    "femme"   = "aquamarine"))


```

À l'intérieur de la fonction `scale_fill_manual()` nous fournissons des mofications **manuelles** 
dans un vecteur `c()`.

.footnote[Utiliser *na.value = "grey"* pour les valeurs manquantes
]

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "homme" = "violetred", 
     "femme" = "aquamarine")) +
theme_gray(base_size = 16)
```

]

???
Mentionnez brièvement les `na.value=` dans la plupart des commandes d'échelle, et la différence entre avoir des valeurs NA dans les données et avoir une valeur manquante explicite telle que "Inconnu".

---

# Échelles - colorbrewer

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
*scale_fill_brewer(
*   type = "qual",
*   na.value = "grey50")

```

Échelles - colorbrewer

.footnote[Utiliser *na.value = "grey"* pour les valeurs manquantes
]

]

.pull-right[

```{r, eval=T, echo=F}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_brewer(type = "qual", na.value = "grey50")+
theme_gray(base_size = 16)
```

]

???
Mentionnez brièvement les `na.value=` dans la plupart des commandes d'échelle, et la différence entre avoir des valeurs NA dans les données et avoir une valeur manquante explicite telle que "Inconnu".

---

# Échelles - axe y ajusté

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "homme" = "violetred", 
     "femme" = "aquamarine")) +
*scale_y_continuous(
*  breaks = seq(from = 0,
*               to = 250,
*               by = 10))
```

Dans `scale_y_continuous()` nous ajustons les ruptures de l'axe y à l'aide de `seq()` pour définir une séquence numérique.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "homme" = "violetred", 
     "femme" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10)) +
theme_gray(base_size = 18)
```

]

---

# Commencer les axes à 0

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "homme" = "violetred", 
     "femme" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10),
* expand = c(0, 0)) +
*scale_x_discrete(
*  expand = c(0, 0))
```

Dans `scale_x_` ou `scale_y_` utilisez `expand = c(0,0)` pour supprimer l'espace supplémentaire autour du graphique.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(
    x = district,
    fill = sexe)) +
geom_bar() +
scale_fill_manual(        
  values = c(
     "homme" = "violetred", 
     "femme" = "aquamarine")) +
scale_y_continuous(
  breaks = seq(from = 0,
               to = 250,
               by = 10),
  expand = c(0,0)) +
scale_x_discrete(
  expand = c(0,0)) +
theme_grey(base_size = 18)
```

]

---

# Échelles - étiquettes de l'axe de la date

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram()
```

L'échelle par défaut des axes de date varie en fonction de l'étendue de vos données.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram()+
theme_grey(base_size = 18)

```

]

---

# Échelles - ruptures de l'étiquette de la date

.pull-left[

```{r, eval=F, echo=params$lang == "en"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 mois") #2 mois

```

```{r, eval=F, echo=params$lang == "fr"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 mois") #2 mois

```

```{r, eval=F, echo=params$lang == "ru"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 mois") #2 месяца

```

```{r, eval=F, echo=params$lang == "es"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
*scale_x_date(
*  date_breaks = "2 mois") #2 meses

```

Ajustez les étiquettes des axes avec `scale_x_date()`.

Utilisez des valeurs pour `date_breaks=` telles que "1 semaine", "2 semaines" ou "3 mois".

Ces valeurs permettent d'ajuster les *étiquettes* pour chaque rupture d'axe et non les barres de l'histogramme !

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months") +
theme_grey(base_size = 18)

```

]

???
Pour des conseils sur les barres de geom\_histogram(), voir la page du Epi R Handbook epicurves.

---

# Échelles - étiquettes de l'axe de la date

.pull-left[

```{r, eval=F, echo=T}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months",
* date_labels = "%d %b\n%Y")

```

Spécifiez le format de l'étiquette de date à l'aide de `date_labels=` en utilisant la  
[syntaxe "strptime"](https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/strptime)

`"%d %b %Y"` pour JJ MM AAAA.

.footnote[Voir les chapites [Epicurves](https://epirhandbook.com/epidemic-curves.html) et [Strings](https://epirhandbook.com/characters-and-strings.html) du Manuel Epi R
]

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 months",
  date_labels = "%d %b\n%Y"
) +
theme_grey(base_size = 18)

```

]

???
/n est une nouvelle ligne

---

# Échelles - étiquettes efficaces automatiques

.pull-left[

```{r, eval=F, echo=params$lang == "en"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", #2 weeks
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "fr"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", # 2 semaines
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "ru"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", # 2 недели
* labels = label_date_short() )

```

```{r, eval=F, echo=params$lang == "es"}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
* date_breaks = "2 weeks", #2 semanas
* labels = label_date_short() )

```

Ou bien, assignez simplement `labels=` à la fonction `label_date_short()` du paquet [{scales}](https://scales.r-lib.org/)

L'année ne sera pas répétée sur chaque étiquette.

]

.pull-right[

```{r}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = scales::label_date_short())+
theme_grey(base_size = 18)

```

]

---

class: inverse, center, middle

## Étiquettes dans {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "labels.png")))
```

---

# Étiquettes de graphique

.pull-left[

```{r, echo=TRUE, eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")
```

]

.pull-right[

```{r, echo=FALSE, eval=TRUE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(x = date_symptomes, fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
theme_grey(base_size = 18)
```

]

---

# Étiquettes de graphique

.pull-left[

```{r, echo=params$lang == "en", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Epidemic curve of Ebola outbreak",
*  subtitle = "Confirmé cases, 2014",
*  x = "Date",
*  y = "Number of cases",
*  caption = "Fictional Ebola donnees",
*  fill = "Hospital"
) +
```

```{r, echo=params$lang == "fr", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Courbe épidémique de l'épidémie d'ebola",
*  subtitle = "Cas confirmés, 2014",
*  x = "Date",
*  y = "Nombre de cas",
*  caption = "Données fictionnelles",
*  fill = "Hôpital"
) +
```

```{r, echo=params$lang == "ru", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Эпидемическая кривая вспышки лихорадки Эбола",
*  subtitle = "Подтвержденные случаи, 2014 год",
*  x = "Дата",
*  y = "Количество случаев",
*  caption = "Вымышленные данные по лихорадке Эбола",
*  fill = "Больница"
) +
```

```{r, echo=params$lang == "es", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
*labs(
*  title = "Curva epidémica del brote de ébola",
*  subtitle = "Casos confirmados, 2014",
*  x = "Fecha",
*  y = "Número de casos",
*  caption = "Datos ficticios sobre el ébola",
*  fill = "Hospital"
) +
```

Utilisez `labs()` comme ci-dessus. Remarque : modifiez le titre de la légende via l'esthétique qui a créé la légende (par ex. `fill=`).

]

.pull-right[

```{r, echo=FALSE, eval=params$lang == "en", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Epidemic curve of Ebola outbreak",
  subtitle = "Confirmé cases, 2014",
  x = "Date",
  y = "Number of cases",
  caption = "Fictional Ebola donnees",
  fill = "Hospital"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "fr", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Courbe épidémique de l'épidémie d'ebola",
  subtitle = "Cas confirmés, 2014",
  x = "Date",
  y = "Nombre de cas",
  caption = "Données fictionnelles",
  fill = "Hôpital"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "ru", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
 title = "Эпидемическая кривая вспышки лихорадки Эбола",
 subtitle = "Подтвержденные случаи, 2014 год",
 x = "Дата",
 y = "Количество случаев",
 caption = "Вымышленные данные по лихорадке Эбола",
 fill = "Больница"
) +
theme_grey(base_size = 18)
```

```{r, echo=FALSE, eval=params$lang == "es", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = date_symptomes,
    fill = hopital)) +
geom_histogram() +
scale_x_date(
  date_breaks = "2 weeks",
  labels = label_date_short() )+
scale_fill_brewer(type = "qual",
                  na.value = "grey50")+
labs(
  title = "Curva epidémica del brote de ébola",
  subtitle = "Casos confirmados, 2014",
  x = "Fecha",
  y = "Número de casos",
  caption = "Datos ficticios sobre el ébola",
  fill = "Hospital"
) +
theme_grey(base_size = 18)
```

]

---

# Étiquettes dynamiques

Incorporez un code à l'intérieur `str_glue("texte ici {CODE ICI} texte ici")`  
Le code sera mis à jour avec les données.

```{r, eval=params$lang == "en", echo=params$lang == "en"}
str_glue("Data as of {Sys.Date()}")
```

```{r, eval=params$lang == "fr", echo=params$lang == "fr"}
str_glue("Données à partir de {Sys.Date()}")
```

```{r, eval=params$lang == "ru", echo=params$lang == "ru"}
str_glue("Данные по состоянию на {Sys.Date()}")
```

```{r, eval=params$lang == "en", echo=params$lang == "es"}
str_glue("Datos a partir de {Sys.Date()}")
```

--

```{r, eval=params$lang == "en", echo=params$lang == "en"}
str_glue("{fmt_count(surv, is.na(date_symptomes))} cases missing onset and not shown")
```

```{r, eval=params$lang == "fr", echo=params$lang == "fr"}
str_glue("La date d'apparition est manquante pour {fmt_count(surv, is.na(date_symptomes))}")
```

```{r, eval=params$lang == "ru", echo=params$lang == "ru"}
str_glue("{fmt_count(surv, is.na(date_symptomes))} случаи с отсутствующим началом и не показаны")
```

```{r, eval=params$lang == "es", echo=params$lang == "es"}
str_glue("{fmt_count(surv, is.na(date_symptomes))} casos que faltan para el inicio y non se muestran")
```

.footnote[Voir le chapitre du Manuel de l'Epi R sur les [Strings](https://epirhandbook.com/characters-and-strings.html#dynamic-strings) et le chapitre sur le paquet {stringr}.
]


???
Expliquez brièvement que dans str\_glue, tout ce qui est entre crochets sera exécuté comme du code R.

---

class: inverse, center, middle

## Thèmes en {ggplot2}

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "ggplot_scales_themes", "themes.png")))
```

---

# Thèmes

Les thèmes sont des ajustements visuels **sans données**, par exemple :

- Arrière-plan du graphique
- Taille, couleur et orientation du texte
- Position de la légende

--

Le pouvoir du paquet {ggplot2} - vous pouvez faire des ajustements extrêmement petits

... si vous le souhaitez.

---

# Thèmes

.pull-left[

[Des "thèmes complets"](https://ggplot2.tidyverse.org/reference/ggtheme.html) sont faciles à ajouter.

```{r, eval=F, echo=params$lang == "en"}
# Try one of these...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "fr"}
# Essayez un de ces...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "ru"}
# Попробуйте одно из этих...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

```{r, eval=F, echo=params$lang == "es"}
# Prueba uno de estos...
theme_minimal()
theme_light()
theme_bw()
theme_gray()
theme_dark()
theme_void()
theme_classic()
```

Essayez l'argument `base_size = 16` pour augmenter rapidement la taille du texte.

]

.pull-right[

```{r, echo=FALSE, eval=TRUE, tidy=FALSE}

minimal <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_minimal()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_minimal(base_size = 18)



bw <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_bw()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_bw(base_size = 18)



grey <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_grey()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_grey(base_size = 18)


dark <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_dark()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_dark(base_size = 18)



void <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_void()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_void(base_size = 18)



light <- ggplot(data = surv,
       mapping = aes(
         x = age_ans,
         y = ht_cm),    
       alpha = 0.3)+
  geom_point()+
  labs(
    title = "theme_light()",
    x = "Age (ans)",
    y = "Height (cm)")+
  theme_light(base_size = 18)


themes_plots <- cowplot::plot_grid(
  minimal, light,
  bw, grey,
  dark, void,
  nrow = 3, rel_widths = c(2,2))

themes_plots

```

]

---

# Micro-ajustements

Effectuez des micro-ajustements au sein de la fonction `theme()`.

Fournissez des arguments pour chaque petit changement que vous voulez faire, par exemple :

| Composant du graphique                                | Argument de theme          | 
| -------------------------------------------------- | ---------------------------- |
| position de la légende                             | `legend.position = `                             | 
| direction de la légende (horizontale ou verticale) | `legend.direction = `                             | 

--

Ceux-ci peuvent être *très très* spécifiques :

| Composante du graphique                       | Argument de theme          | 
| -------------------------------------------------- | ---------------------------- |
| Longueur des lignes de l'axe X                      | `axis.ticks.length.x = `                             | 

Il existe littéralement des centaines d'options.

???
Pensez à tous les ajustements minutieux que vous faites lorsque vous créez un graphique dans Excel. Combien de fois devez-vous refaire toutes ces étapes ? Toutes ces étapes peuvent être codées, ce qui rend le graphique facilement modifiable

---

# Thèmes

.pull-left[

Effectuez des micro-ajustements au sein de `theme()`.

```{r, echo=params$lang == "en", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Height by age",
  x = "Age (ans)",
  y = "Height (cm)",
  color = "sexe")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "fr", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Taille par âge",
  x = "Âge (années)",
  y = "Taille (cm)",
  color = "Sexe")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "ru", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
   title = "Рост по возрасту",
  x = "Возраст (годы)",
  y = "Рост (см))",
  color = "Пол")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

```{r, echo=params$lang == "es", eval=FALSE, tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Altura por edad",
  x = "Edad (años)",
  y = "Altura (cm)",
  color = "Género")+
theme_minimal(base_size = 16) +
*theme(
* legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

]

.pull-right[

La syntaxe demande de l'entraînement - voir [cette liste](https://ggplot2.tidyverse.org/reference/theme.html) des arguments spécifiques pour chaque fonctionnalité.

```{r, echo=FALSE, eval=params$lang == "en", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Height by age",
  x = "Age (ans)",
  y = "Height (cm)",
  color = "sexe")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "fr", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Taille par âge",
  x = "Âge (années)",
  y = "Taille (cm)",
  color = "Sexe")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "ru", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
   title = "Рост по возрасту",
  x = "Возраст (лет)",
  y = "Рост (см))",
  color = "Пол")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

```{r, echo=FALSE, eval=params$lang == "es", tidy=FALSE}
ggplot(
  data = surv,
  mapping = aes(
    x = age_ans,
    y = ht_cm,
    color = sexe),    
    alpha = 0.3) +
geom_point() +
labs(
  title = "Altura por edad",
  x = "Edad (años)",
  y = "Altura (cm)",
  color = "Género")+
  theme_minimal(base_size = 16)+
  theme(
    legend.position = "bottom",
    plot.title = element_text(color = "red",
                              size = 20,
                              face = "bold"),
    axis.title.y = element_text(angle = 0))
```

]

???
Discutez brièvement ces arguments de theme() et expliquez comment ils se composent de deux parties, tout comme `mapping = aes()`.
Expliquez que personne ne les a tous mémorisés, mais que les plus courants sont faciles à retenir une fois que vous les utilisez suffisamment.  
N'oubliez pas de les ajouter APRÈS chaque thème complet.

---

# Thèmes - `element_text()`

Si vous changez le *texte*, les micro-ajustements doivent être effectués *dans* `element_text()`

```{r, eval=F, echo=T}
theme(
 legend.position = "bottom",
* plot.title = element_text(
*   color = "red",
*   face = "bold"),
* axis.title.y = element_text(angle = 90))
```

Il s'agit d'une syntaxe similaire à `mapping = aes()`

???
Discutez brièvement ces arguments de theme() et expliquez comment ils se composent de deux parties, tout comme `mapping = aes()`.
Expliquez que personne ne les a tous mémorisés, mais que les plus courants sont faciles à retenir une fois que vous les utilisez suffisamment.

---

class: inverse, center, middle

## Exercice !

Allez sur le site du cours
Ouvrez l'exercice du module 5, partie 2, et connectez-vous  
Suivez les instructions pour continuer à coder votre projet R "ebola".
Informez un instructeur si vous n'êtes pas sûr.e.s de ce que vous devez faire.

```{r, eval=TRUE, echo=FALSE, out.width="50%"}
# adding xfun::relative_path() creates a dynamic file path between the Rmd location and the here() path.
# It dynamically creates the ../../etc filepath.

knitr::include_graphics(xfun::relative_path(here::here("images", "breakout", "teamwork3.png")))
```


