<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Introduction to GIS in R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Base maps, shapefiles, and geometries" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/tabwid/tabwid.css" rel="stylesheet" />
    <script src="libs/tabwid/tabwid.js"></script>
    <link href="libs/countdown/countdown.css" rel="stylesheet" />
    <script src="libs/countdown/countdown.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Introduction to GIS in R
]
.author[
### Base maps, shapefiles, and geometries
]
.date[
### <a href="mailto:contact@appliedepi.org">contact@appliedepi.org</a>
]

---










&lt;style type="text/css"&gt;
    .remark-slide table{
      border: none
    }
    .remark-slide-table {
      
    }
    tr:first-child {
      border-top: none;
  }
    tr:last-child {
    border-bottom: none;
  }
&lt;/style&gt;





# Thank you for joining us  

Brief introductions from the instructors  

**Thank you for your service** *to your community in these busy times for public health. We are glad that you are taking the time to learn R with us.*  



???
Do a brief round of introductions  




---
# Why use R for GIS?

## Reproducible  

We can re-run the same code and get the same outcome, or use new data and see how findings have changed. Because it is written as a script it is reproducible, and...

&lt;img src="../../images/welcome/clone_image.jpg" width="50%" /&gt;


---
# Why use R for GIS?

## Shareable  

You can share scripts and other people can produce the same findings and results as you. This makes it easy to produce automated reports and share the work between people.

&lt;img src="../../images/welcome/shareable_image.PNG" width="50%" /&gt;

---
# Why use R for GIS?

## Easy (once you learn the syntax!)  

.pull-left[ We know that R can be scary (it was for us too when we first learned it!), but once you learn the basics, and how to apply these to GIS methods in R, you can very quickly produce in depth analysis of data in an efficient, effective and reproducible way! 
]

.pull-right[
&lt;img src="../../images/welcome/easy_image.jpg" width="100%" /&gt;
]


---
class: inverse, center, middle

# Applied Epi: who are we? 


---
## About Applied Epi

We are **elevating frontline epidemiology** with open-source analytics tools

Our team of **170 practitioners** live in over **40 countries**. 

.pull-left[
- Local government epidemiologists and public health practitioners
- Emergency responders
- Data science educators
- Applied researchers
- Clinicians
- GIS experts...

]

.pull-right[

&lt;img src="../../images/welcome/team_locations.jpg" width="200%" /&gt;

]



---

# The Epidemiologist R Handbook

&lt;img src="../../images/welcome/Epi R Handbook Banner Beige 1500x500.png" width="75%" /&gt;

- 50 chapters of free best-practice code examples - available online and offline
- 2.1 million views from 600,000 users (4,000 views daily)
- Being translated into 8 languages


&gt; *"The epidemiologist greatest companion"* &lt;br&gt; - Epidemiologist, Nigeria CDC

&gt; *"[It] weaves together so much, so succinctly, and so incredibly clearly"* &lt;br&gt; - Epidemiologist, US CDC


---
class: inverse, center, middle

# GIS for R: Course Format



---
# Course objectives

We want to help you:  

- Understand the basic components required for GIS in R, including basemaps, shapefiles, Coordinate Reference Systems (CRS), and spatial joins

--

- Understand how we can build different types of maps in R using {sf} and {ggplot2}

--

- Understand different types of spatial analysis and how they can be applied in R, including Nearest Neighbour (NN) and Buffer analysis

--

- Understand and develop code for creating more advanced maps, including Choropleth maps, Heat maps, and Interactive maps. 



---
# Course format

- **Classroom instruction** 2 half-day modules (3.5 hours each)

  + Module 1: Shapefiles, basemaps, joins, and visualising spatial data  
  + Module 2: Intro to spatial analysis and interactive maps  
  + Extra: COVID-19 case study  
  
.footnote[Email us about **"R Support Desk"** services for on-call support]

---
# Course schedule

&lt;div class="tabwid"&gt;&lt;style&gt;.cl-157d6c1c{}.cl-1571dc9e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-15761cd2{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-15763708{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763712{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763713{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1576371c{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1576371d{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763726{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763727{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763728{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-15763730{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1576373a{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1576373b{width:0.659in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-1576373c{width:2.918in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}&lt;/style&gt;&lt;table data-quarto-disable-processing='true' class='cl-157d6c1c'&gt;&lt;thead&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;th class="cl-15763708"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Topic&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-15763712"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Description&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;1&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Introduction to GIS for R (Day 1)&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;2&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Shapefiles, {sf}, and CRS&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;3&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Spatial joins and admin levels&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;4&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;{ggplot2} and basemaps&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-1576371d"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;5&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-15763726"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Choropleth maps and heat maps&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;6&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Introduction to Spatial Analysis (Day 2)&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763727"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;7&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-15763728"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Nearest neighbour analysis&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763713"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;8&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576371c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Buffer analysis&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-15763730"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;9&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576373a"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;Interactive maps&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-1576373b"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;10&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-1576373c"&gt;&lt;p class="cl-15761cd2"&gt;&lt;span class="cl-1571dc9e"&gt;COVID-19 outbreak case study&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;



---
# Data used in this course  

* Ebola case study in Sierra Leone
     * **Surveillance linelist** (primary dataset)  
     * Hospital linelists from 5 hospitals  
     * Population data stratified by demographic groups and admin levels
     * Sierra Leone shape files stratified by admin levels
     * Health facility shape files

* COVID-19 case study in USA
     * **Surveillance linelist** (primary dataset)
     * Population data stratified by cities
     * Fulton County, Georgia, USA, shape files
     * Fulton County, Georgia, USA, map tiles
     
.footnote[All data are not real. All files can be found in the course folder.]  


---
# Exercises

Most learning happens when you are coding, and have rapid on-hand assistance

- **Each module:** Explanation -&gt; Live demo -&gt; Exercises -&gt; Plenary debrief  

--

- **Coding assistance**: raise your hand during the exercise for 1-on-1 support

--

- **Screen share** helps instructors catch your errors early

--

- **The exercises are long** - it is OK if you do not finish. The complete code is available to you in the **"scripts/backup"** folder  

--

- **Extra support** is available if you are confused  


---
# This session: objectives &amp; schedule  

**In this module we aim to help you:**  
* Understand basemaps, projections, and CRS
* Learn how to use {sf} and spatial joins for mapping
* Write R code for creating maps using {ggplot2}
* Create Choropleth maps


&lt;div class="tabwid"&gt;&lt;style&gt;.cl-15a58c74{}.cl-159b304e{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-159f413e{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-159f5692{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f569c{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f569d{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f569e{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56a6{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56a7{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56b0{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56b1{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56b2{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56ba{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56c4{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56c5{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56c6{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56ce{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56cf{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56d8{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56d9{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56e2{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56e3{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56ec{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56ed{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56f6{width:1.041in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56f7{width:0.973in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-159f56f8{width:2.679in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(255, 255, 255, 0.00);border-top: 0 solid rgba(255, 255, 255, 0.00);border-left: 0 solid rgba(255, 255, 255, 0.00);border-right: 0 solid rgba(255, 255, 255, 0.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}&lt;/style&gt;&lt;table data-quarto-disable-processing='true' class='cl-15a58c74'&gt;&lt;thead&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;th class="cl-159f5692"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Time&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-159f569c"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Location&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;th class="cl-159f569d"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Topic&lt;/span&gt;&lt;/p&gt;&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f569e"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;15 minutes&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56a6"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Main&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56a7"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Welcome, course logistics, Why R?&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56b0"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;30 minutes&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56b1"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Main&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56b2"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Lecture 1: Introduction to GIS for R&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56ba"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;15 minures&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56c4"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Main&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56c5"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Demo&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56c6"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;1 hour&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56ce"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Breakouts&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56cf"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Exercise&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56d8"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;15 minutes&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56d9"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Main&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56e2"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Demo: Choropleths and heat maps&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56c6"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;1 hour&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56ce"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Breakouts&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56cf"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Exercise&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td class="cl-159f56e3"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;15 minutes&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56ec"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Main&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;td class="cl-159f56ed"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Plenary debrief&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;tfoot&gt;&lt;tr style="overflow-wrap:break-word;"&gt;&lt;td  colspan="3"class="cl-159f56f6"&gt;&lt;p class="cl-159f413e"&gt;&lt;span class="cl-159b304e"&gt;Take breaks as you wish during the exercise&lt;/span&gt;&lt;/p&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tfoot&gt;&lt;/table&gt;&lt;/div&gt;

???
Note stretch breaks throughout.




---
class: inverse, center, middle  

# Stretch break!

(and time to ask questions)  

&lt;img src="../../images/breakout/stretch.png" width="50%" /&gt;

<div class="countdown" id="timer_4ab1863a" data-update-every="1" tabindex="0" style="right:0;bottom:0;">
<div class="countdown-controls"><button class="countdown-bump-down">&minus;</button><button class="countdown-bump-up">&plus;</button></div>
<code class="countdown-time"><span class="countdown-digits minutes">02</span><span class="countdown-digits colon">:</span><span class="countdown-digits seconds">00</span></code>
</div>




---
# RStudio projects  



.pull-left[

All the work in this course will take place within an **RStudio project** - a self-contained and portable R working environment.  

It is a folder with all the files associated with a distinct project:  
* Data files  
* R scripts  
* Outputs  
* etc.

This makes your life immensely easier.  

The project is represented by a .Rproj file in the folder.  

]

.pull-right[
&lt;img src="../../images/functions_packages/project_briefcase.png" width="85%" /&gt;

* 📂 gis_course  
     * gis_course.Rproj  
     * 📜 **linelist.csv**
     * 📄 **my_analysis.R**
     
]

???
We will help 
You can zip the folder and share it with a colleague, it can be hosted on a shared drive, and can be synced with a Github repository.  



---
class: inverse, center, middle  

# Shapefiles, {sf}, and CRS



---
# Shapefiles 
.pull-left[
- Multiple layers make file 
- Made up of: 
  - Points, lines, polygons
- handled with [{sf}](https://r-spatial.github.io/sf/) package
  - simple features:
   make things much more simple!
  - Can use tidyverse syntax as if dataframes
- Other formats exist (e.g. GeoJson)
]

.pull-right[

&lt;img src="../../images/gis/shapefiles.png" width="85%" /&gt;
]

.footnote[
See the [EpiRHandbook section on GIS basics](https://epirhandbook.com/gis-basics.html)
]

???
Until a few years ago geospatial work in R was very painful - but with SF it has
now become as easy as dataframes in tidyverse! 

---

# Mapping Geometries 
### What can geometries represent? 

.pull-left[
- Points
     - Locations of people
     - Locations of facilities 
- Lines  
     - Roads
     - Rivers
- Polygons/areas
     - Countries
     - Lakes
]

.pull-right[
&lt;img src="../../images/gis/points_lines_polygons.png" width="85%" /&gt;

]

.footnote[Image source: https://desktop.arcgis.com/en/arcmap/10.3/manage-data/geodatabases/feature-class-basics.htm]


---
# Storing Spatial Data 


### Shapefiles

- Common data format for storing **vector spatial data**
- Can represent geographical information as: 
     - Points
     - Lines
     - Polygons
- Collection of *at minimum* 3 file types: **.shp**, **.shx**, **.dbf**
- All 3 components needed to read shapefile

&lt;img src="../../images/gis/shapefiles_directory.png" width="100%" /&gt;


---

# Raster versus Vector

&lt;img src="../../images/gis/raster_vs_vector.png" width="60%" /&gt;

---

# Storing Spatial Data in R


## Simple features {sf}
  * Imported geometry (shapefiles) become a variable in your dataframe
  * Shapefiles in R environment will have class *"sf"* 
  * Shapefiles can be joined to other dataframes using {sf} join functions
  * {sf} functions for spatial data manipulation, analysis, and visualisation


.pull-right[

&lt;img src="../../images/gis/sf_hex.gif" width="40%" /&gt;

]

.footnote[Image source: https://desktop.arcgis.com/en/arcmap/10.3/manage-data/geodatabases/feature-class-basics.htm]]


---

# Storing Spatial Data in R

## Benefits of {sf}

.pull-left[
- Compatible with QGIS and POSTGIS
- *Very fast* reading and writing of large shapefiles
- Enhanced plotting performance with multiple packages
     - *"sf"* objects can be treated as data frames
     - {sf} functions work with tidyverse (`%&gt;%`)
     - `st_` naming convention: `st_as_sf()`, `st_join()` 
]


.pull-right[
&lt;img src="../../images/gis/shape_data_snippet.png" width="80%" /&gt;
]


---

# Importing Spatial Data in R


```r
# import shapefile
shapefile &lt;- read_sf(
  # file path to shape file
  here("data", "ebola","admin_boundaries", "sle_adm3.shp")) %&gt;% 
  clean_names()  
```



```
## Simple feature collection with 167 features and 19 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -13.30901 ymin: 6.923379 xmax: -10.27056 ymax: 9.999253
*## Geodetic CRS:  WGS 84
## # A tibble: 167 × 20
##    objectid admin3name   admin3pcod admin3ref_n admin2name admin2pcod admin1name
##       &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1        1 Yakemu Kpuk… SL030412   Yakemu Kpu… Pujehun    SL0304     Southern  
##  2        2 Koya         SL020412   Koya        Port Loko  SL0204     Northern  
##  3        3 Bureh Kasse… SL020401   Bureh Kass… Port Loko  SL0204     Northern  
##  4        4 Panga Kabon… SL030404   Panga Kabo… Pujehun    SL0304     Southern  
##  5        5 Galliness P… SL030402   Galliness … Pujehun    SL0304     Southern  
##  6        6 Kpaka        SL030403   Kpaka       Pujehun    SL0304     Southern  
##  7        7 Bum          SL030202   Bum         Bonthe     SL0302     Southern  
##  8        8 Komboya      SL030109   Komboya     Bo         SL0301     Southern  
##  9        9 Valunia      SL030114   Valunia     Bo         SL0301     Southern  
## 10       10 Barri        SL030401   Barri       Pujehun    SL0304     Southern  
## # ℹ 157 more rows
## # ℹ 13 more variables: admin1pcod &lt;chr&gt;, admin0name &lt;chr&gt;, admin0pcod &lt;chr&gt;,
## #   date &lt;date&gt;, valid_on &lt;date&gt;, valid_to &lt;date&gt;, shape_leng &lt;dbl&gt;,
## #   shape_area &lt;dbl&gt;, rowcacode0 &lt;chr&gt;, rowcacode1 &lt;chr&gt;, rowcacode2 &lt;chr&gt;,
## #   rowcacode3 &lt;chr&gt;, geometry &lt;MULTIPOLYGON [°]&gt;
```



---
# Coordinate reference systems



&lt;iframe width="100%" height="676" frameborder="0"
  src="https://observablehq.com/embed/@d3/projection-transitions?cells=viewof+context"&gt;&lt;/iframe&gt;

.footnote[
Source: [Mike Bostock]("https://twitter.com/mbostock/status/1292887409474994176")
]

---

# Coordinate reference systems


.pull-left[
- Defined using EPSG
- Turns spherical world into two dimensions
- Data you receive should include the CRS
- Most common is WGS84 (EPSG 4326)
      - CRS used for GPS
- Files with different CRS may **not** work together
- Different countries use different types of CRS! 
      - Do you know what your country uses?


.footnote[Image source: https://s3.amazonaws.com/files.zevross.com/workshops/spatial/slides/html/4-crs.html#23]

]


.pull-right[

&lt;img src="../../images/gis/projections_example.png" width="85%" /&gt;
]



---

# Changing the CRS


```r
# transform shapefile to different CRS format
shapefile &lt;- st_transform(shapefile, crs = 3857)
```



```
## Simple feature collection with 167 features and 19 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -1481552 ymin: 772589.5 xmax: -1143313 ymax: 1118806
*## Projected CRS: WGS 84 / Pseudo-Mercator
## # A tibble: 167 × 20
##    objectid admin3name   admin3pcod admin3ref_n admin2name admin2pcod admin1name
##  *    &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;      &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;     
##  1        1 Yakemu Kpuk… SL030412   Yakemu Kpu… Pujehun    SL0304     Southern  
##  2        2 Koya         SL020412   Koya        Port Loko  SL0204     Northern  
##  3        3 Bureh Kasse… SL020401   Bureh Kass… Port Loko  SL0204     Northern  
##  4        4 Panga Kabon… SL030404   Panga Kabo… Pujehun    SL0304     Southern  
##  5        5 Galliness P… SL030402   Galliness … Pujehun    SL0304     Southern  
##  6        6 Kpaka        SL030403   Kpaka       Pujehun    SL0304     Southern  
##  7        7 Bum          SL030202   Bum         Bonthe     SL0302     Southern  
##  8        8 Komboya      SL030109   Komboya     Bo         SL0301     Southern  
##  9        9 Valunia      SL030114   Valunia     Bo         SL0301     Southern  
## 10       10 Barri        SL030401   Barri       Pujehun    SL0304     Southern  
## # ℹ 157 more rows
## # ℹ 13 more variables: admin1pcod &lt;chr&gt;, admin0name &lt;chr&gt;, admin0pcod &lt;chr&gt;,
## #   date &lt;date&gt;, valid_on &lt;date&gt;, valid_to &lt;date&gt;, shape_leng &lt;dbl&gt;,
## #   shape_area &lt;dbl&gt;, rowcacode0 &lt;chr&gt;, rowcacode1 &lt;chr&gt;, rowcacode2 &lt;chr&gt;,
## #   rowcacode3 &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;
```


---

# Projections

.pull-left[
- Different methods for turning the globe into a map
- All projections lead to some distortion
- Biases your perception of regional size 
]

.pull-right[

&lt;img src="../../images/gis/projections_face.png" width="100%" /&gt;

]

.footnote[Image source: From Charles H. Deetz, Elements of Map Projection With Applications to Map and Chart Construction (Washington: Government Printing Office, 1921): 51.]

---
# What's smaller?


&lt;img src="../../images/gis/russia_africa_kms.png" width="80%" /&gt;


--


**It's because of the projection!**



---

# Projections


- There are standard projections for most locations.
- Google them and use them!


&lt;img src="../../images/gis/standard_projections.png" width="60%" /&gt;



.footnote[Image source: https://www.mdpi.com/ijgi/ijgi-09-00196/article_deploy/html/images/ijgi-09-00196-g005.png
]
---
# Other key parts of map

.pull-left[
- Compass or North arrows
- Scale bars
- Legends
- Topography
- Any others you can think of?
]

.pull-right[
&lt;img src="../../images/gis/map_components.png" width="140%" /&gt;

]

.footnote[Image source: https://quizlet.com/310047587/parts-of-a-map-diagram/
]


---

class: inverse, center, middle  

# Spatial joins and admin levels

---

# Spatial joins

 - We want to combine two dataframes with *common columns* 
 - Multiple different types of joins available from {sf}
     - `st_join`   (remember left joins?)
     - `st_touches`
     - `st_crosses`
     - `st_contains`
     - `st_within`
     - `st_overlaps`
     - `st_covers`
     - `st_covered_by`
     - `st_is_within_distance`

.footnote[
See the [EpiRHandbook section on joining data](https://epirhandbook.com/joining-data.html)
]

---

# Admin levels and joins

## How is your survey data formatted?

What type of spatial data do you have in your survey data? In your shape files? 

- Administrative levels e.g. Adm1, Adm2, Adm3
- Districts, e.g. by name or by number
- Countries or regional separations e.g. England and Wales vs. United Kingdom
- Longitude and latitude

Once we consider the format, we can think about how to join our survey data with our shape files! We will get plenty of practice in the exercises today. 

---

class: inverse, center, middle  

# {ggplot2} and basemaps

---
# gg-what??  

--

- The **ggplot2** *package* is the most popular data visualization tool in R  

--

- Its `ggplot()` *function* is at the core of the package  

--

- This whole approach is colloquially known as “ggplotting”  

--

- Resulting figures are sometimes affectionately called “ggplots”  

--

**ggplot2** benefits from a wide variety of supplementary R packages that extends its functionalities, such as **gganimate**, **ggthemr**, **ggdendro**, **gghighlight**, **ggforce**...  

.footnote[
*Bonus question:* What does the "gg” in these names represent?
]

???
- "gg" represents the “grammar of graphics” used to construct the figures 


---
# Syntax overview  

Build a plot object by “adding” commands on top of one another that specify plot layers and design elements  


--

The order of layers will usually look like this:

1) **"Open" the plot** with the `ggplot()` command and specify the dataset  

--

2) **"Map" data columns** to "aesthetic" features of the plot such as axes, color, size, shape, fill, transparency  

--

3) **Add (`+`) “geom” layers** that visualize data geometrically as shapes  

--

4) **Modify "scales"**, such as a color scale or y-axis breaks  

--

5) **Add "theme" plot design elements** such as axis labels, title, caption, fonts, text sizes, background themes, or axes rotation  

--

These layers are "added" sequentially with `+` symbols.  
**ggplot2** commands can be quite long!  


???
Remember that although the commands may be long, it is infinitely easier to edit and recycle than in Excel  


---

#{ggplot2} with map layers

&lt;img src="../../images/gis/ggplot2_map_example.png" width="140%" /&gt;



---

# Basemaps

.pull-left[
- A screenshot of the map area 
- Called tiles 
    - Smaller images pieced together
- Added for context (bottom layer of {ggplot2} plot)
- A lot of different tile servers
- A lot of different R packages
    - We demonstrate {ggspatial}
    - Able to save tiles for offline use
    - Also have scalebars
]

.pull-left[
&lt;img src="slides_gis1_files/figure-html/unnamed-chunk-30-1.png" width="504" /&gt;
]
---
# Bounding boxes

.pull-left[
- A rectanglur area defined by
   - 2 longitudes
   - 2 latitudes
- Aligned with coordinate axes
- Identifies a map area specified:
   - manually with coordinate values 
   - using reference area or data values to identify the smallest area (box) encompassing a feature of interest

]

.pull-right[

&lt;img src="../../images/gis/bounding_box.png" width="100%" /&gt;

]
---
# Download &amp; plot basemap



```r
# get the bounding box for the shapefile 
bounding_box &lt;- shapefile %&gt;% 
  st_bbox()
# plot a base map including scale bar 
basemap &lt;- ggplot() +
  # change the bounding box to an sf object
  # this defines the area to download map tiles for
  geom_sf(data = st_as_sfc(bounding_box)) +
  # download map tiles and add to the plot
  annotation_map_tile(
    # define what map tiles to use
    type =  "cartolight",
    # define folder to store tile images 
    cachedir = here::here("data", "map_tiles"),
    # define if should download tiles each time
    forcedownload = FALSE,
    # hide messages about download status and zoom
    progress = "none" )
```

---
# Download &amp; plot basemap

&lt;img src="slides_gis1_files/figure-html/unnamed-chunk-33-1.png" width="504" /&gt;

---
# Adding the data


Once we have our basemap we might want to consider creating a bounding box around our feature of interest. This could include considering: 

- Where is our outbreak located and which features are we interested in? 
    - Across the whole country?
    - Only specific districts? 
    - Cases and hospitals?
    - Schools? Specific age groups?
    - Gender? Severity of case?
--

Once we've identified our features of interest, we can add these as **another layer** to our **ggplot**
- Use `geom_sf()` to plot data as layer (e.g. cases)
- Data object must be of class `sf`
- End up layering multiple dataframes (objects) with different `geom_sf` layers
- We will go through this format in the demo shortly

---
# Example plot

**Note** basemap is centered **around cases** rather than including the whole country. What would this look like if the whole country was included instead? 

&lt;img src="../../images/gis/simulated_ebola_outbreak.png" width="130%" /&gt;


---

class: inverse, center, middle

# Demo


---
class: inverse, center, middle



## Start the exercise  


&lt;img src="../../images/breakout/teamwork2.png" width="50%" /&gt;

---

class: inverse, center, middle  

# Choropleth maps

---
# Choropleth maps



Sometimes you may not want to show exact location of points, but rather *counts* per *district* or *admin level* instead. We can create *choropleth* maps which show counts by area. 

- Allows use to visualise case counts across a larger region
- How do we need to re-format our data to create a *choropleth* map? 
   - Create a **new** dataframe that summarises *case counts by district*
   - **Join** this with your district or adm shape files 
   - Plot your choropleth with {ggplot2}! 
   - Remember instead of colour for points you will use fill for areas




&lt;img src="../../images/gis/choropleth_example.png" width="50%" style="display: block; margin: auto;" /&gt;


---

class: inverse, center, middle  

# Heat maps

---

# Heat maps

Rather than points or lines, we plot the interpolated (smoothed) "density" of points. 

- Overlapping points can obscure the spatial distribution
- Heat maps allow us to see easily visualise the spatial distribution

`stat_density2d_filled()` function from the {ggplot2} package using the **original** `data= surv` dataframe (**NOT** an *"sf"* object)
- mapping x to `lon` and `lat` columns
- play around with `alpha =` to see basemap through heat map layer

&lt;img src="../../images/gis/heatmaps.png" width="80%" /&gt;
---

# Heat maps

How to create a heat map:

1. Open an OpenstreetMap base mp cropped to cases with `base_osm_cropped()`
2. Add `stat_density2d_filled()` to the ggplot geom layers
3. Add district boundaries with with white outline on top 


```r
# Add administrative boundaries, cases, facilities
# You have to use inherit.aes = FALSE is you're using the ggmap basemap
ggplot()+
  # base map cropped to cases
  geom_spatraster_rgb(data = base_osm_cropped)+
  
  # density of case points 
  stat_density2d_filled(data = surv,
                        mapping = aes(x = lon, y = lat),
                        alpha = 0.5) +
  # admin boundaries
  geom_sf(data = sle_adm3_cropped,
          fill = NA,
          color = "white")
```

---
# Heat maps
&lt;img src="../../images/gis/heat_map.png" width="90%" /&gt;




---

class: inverse, center, middle

# Demo


---
class: inverse, center, middle



## Back to Exercises


&lt;img src="../../images/breakout/teamwork2.png" width="50%" /&gt;


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
